<!DOCTYPE html>
<!-- saved from url=(0024)http://vamdt.com/la.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>LA</title>
  <style>
    canvas {
      border: 1px solid red;
    }
  </style>

</style></head>
<body>
  <canvas width="1000" height="1000" id="canvas"></canvas> 
  <button id="redraw">重画</button>
  <button id="toImg">hello</button>
  <script type="text/javascript">
    function random_rgb() {
      return Math.floor(Math.random() * 255).toString(16);
    }
    var canvas = document.getElementById('canvas'),
        ctx = canvas.getContext('2d');
    ctx.fillStyle = "#f0f0f0";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    var start_x = 50, start_y = 50, size = 50;
    var lastColor = '';

    ctx.moveTo(start_x, start_y); 

    for (var i = 0; start_y + i * size < canvas.width; i++) {
        ctx.moveTo(start_x, start_y + i * size);
        ctx.lineTo(canvas.width - size, start_y + i * size);
    }
    for (var i = 0; start_x + i * size < canvas.height; i++) {
        ctx.moveTo(start_x + i * size, start_y);
        ctx.lineTo(start_x + i * size, canvas.height - size);
    }
    ctx.strokeStyle='#000000';
    ctx.stroke();

    var grid = [], 
        rowLength = canvas.width / size - 2,
        colLength = canvas.height / size - 2;
    grid = new Array(rowLength);
    for (var i = 0; i < rowLength; i++) {
        grid[i] = new Array(colLength);
        console.log(grid);
        for (var j = 0; j < colLength; j++) {
            grid[i][j] = 0;
        };
    };
    console.log(grid);
    canvas.onclick = function(event) {
        if (event.offsetX < size || 
            event.offsetX > canvas.width - size ||
            event.offsetY < size ||
            event.offsetY > canvas.height - size) {
            console.warn("out!!!")
        } else {
            var xUnitLength = Math.floor(event.offsetX / size) - 1;
            var yUnitLength = Math.floor(event.offsetY / size) - 1;
            if (grid[xUnitLength ][yUnitLength] == 1) {
                grid[xUnitLength][yUnitLength] = 0;
                ctx.fillStyle = "#f0f0f0";
            } else {
                grid[xUnitLength][yUnitLength] = 1;
                ctx.fillStyle = '#' + random_rgb() + random_rgb() + random_rgb();
            }
            var drawX =  Math.floor(event.offsetX / size) * size;
            var drawY =  Math.floor(event.offsetY / size) * size;
            ctx.fillRect(drawX, drawY, size, size);
        }
    }
    // for (var i = 0; i < 18; i++) {
    //   for (var j = 0; j < 18; j++) {
    //     ctx.fillStyle = '#' + random_rgb() + random_rgb() + random_rgb();
    //     if (ctx.fillStyle == lastColor) {
    //       j--;
    //       continue;
    //     };
    //     ctx.fillRect(start_x + i * size, start_y + j* size, size, size);
    //     lastColor = ctx.fillStyle;
    //   };
    // };

    // ctx.fillStyle = "#f0f0f0";
        // ctx.fillRect(150, 50, 100, 400);
        // ctx.fillRect(350, 150, 100, 100);
        // ctx.fillRect(350, 350, 100, 200);
    // ctx.fillRect(50, 150, 200, 100);
    // ctx.fillRect(350, 150, 200, 100);
    // ctx.fillRect(50, 350, 200, 100);
    // ctx.fillRect(350, 350, 200, 100);
    // hua
    // ctx.fillRect(50, 50, 200, 100);
    // ctx.fillRect(350, 50, 200, 100);
    // ctx.fillRect(650, 50, 200, 100);
    // ctx.fillRect(50, 250, 200, 100);
    // ctx.fillRect(50, 550, 100, 300);
    // ctx.fillRect(250, 350, 100, 500);
    // ctx.fillRect(350, 250, 100, 400);
    // ctx.fillRect(350, 750, 100, 100);
    // ctx.fillRect(50, 350, 100, 100);
    // ctx.fillRect(750, 250, 100, 300);
    // ctx.fillRect(550, 250, 200, 100);
    // ctx.fillRect(550, 350, 100, 100);
    // ctx.fillRect(650, 450, 100, 300);
    // ctx.fillRect(550, 550, 100, 200);
    
    // jing
    // ctx.fillRect(150 + 100, 50, 300, 300);
    // ctx.fillRect(50 + 100, 650, 100, 600);
    // ctx.fillRect(150 + 100, 850, 100, 200);
    // ctx.fillRect(450 + 100, 650, 100, 600);
    // ctx.fillRect(150 + 100, 450, 300, 200);
    // ctx.fillRect(250 + 100, 650, 100, 100);
    // ctx.fillRect(150 + 100, 1250, 100, 200);
    // ctx.fillRect(250 + 100, 1150, 100, 400);
    // ctx.fillRect(350 + 100, 1250, 100, 200);
    // ctx.fillRect(350 + 100, 850, 100, 200);
    // ctx.fillRect(550 + 100, 50, 400, 100);
    // ctx.fillRect(1050 + 100, 50, 300, 100);
    // ctx.fillRect(550 + 100, 150, 200, 100);
    // ctx.fillRect(650 + 100, 350, 100, 100);
    // ctx.fillRect(1250 + 100, 150, 100, 300);
    // ctx.fillRect(550 + 100, 250, 400, 100);
    // ctx.fillRect(1050 + 100, 250, 300, 100);
    // ctx.fillRect(550 + 100, 450, 400, 100);
    // ctx.fillRect(1050 + 100, 450, 300, 100);
    // ctx.fillRect(550 + 100, 650, 100, 800);
    // ctx.fillRect(650 + 100, 650, 700, 100);
    // ctx.fillRect(750 + 100, 850, 500, 100);
    // ctx.fillRect(750 + 100, 1050, 500, 100);
    // ctx.fillRect(750 + 100, 1250, 500, 100);
    // ctx.fillRect(750 + 100, 1350, 300, 100);
    // ctx.fillRect(550 + 100, 550, 100, 100);
    // ctx.fillRect(50, 50, 100, 300);
    // ctx.fillRect(50, 450, 100, 1000);
    //

    function redraw() {
        console.log(grid);
        ctx.fillStyle = "#f0f0f0";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (var i = 0; i < grid.length; i++) {
            for (var j = 0; j < grid[i].length; j++) {
                if ( grid[i][j] === 1 ) {
                    ctx.fillStyle = '#' + random_rgb() + random_rgb() + random_rgb();
                    ctx.fillRect( size * (i + 1), size * (j + 1), size, size);
                }
            };
        };
    }

    document.getElementById('redraw').onclick = redraw;

    document.getElementById('toImg').onclick = function() {
      var imgStr = canvas.toDataURL();
      document.body.innerHTML ='<img src="' + imgStr  + '" />'
    }
  </script>


</body><div></div><div></div></html>
